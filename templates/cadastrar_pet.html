{% extends "base.html" %}

{% block title %}Cadastrar PET Perdido{% endblock %}

{% block content %}
<h2>Cadastrar Informações do PET Perdido</h2>
<form method="POST" enctype="multipart/form-data" action="{{ url_for('cadastrar_pet') }}">
    <div class="form-group">
        <label for="nome_pet">Nome do PET (opcional)</label>
        <input type="text" class="form-control" id="nome_pet" name="nome_pet">
    </div>
    <div class="form-group">
        <label for="especie">Espécie *</label>
        <input type="text" class="form-control" id="especie" name="especie" required placeholder="Ex: Cachorro, Gato">
    </div>
    <div class="form-row">
        <div class="form-group col-md-6">
            <label for="bairro">Bairro onde foi visto por último *</label>
            <select id="bairro" name="bairro" class="form-control" required>
                <option value="">Selecione o Bairro</option>
                {% for b in bairros %}
                <option value="{{ b }}">{{ b }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="form-group col-md-6">
            <label for="rua">Rua onde foi visto por último *</label>
            <select id="rua" name="rua" class="form-control" required>
                <option value="">Selecione a Rua (após escolher o bairro)</option>
            </select>
        </div>
    </div>
     <div class="form-group">
        <label for="cidade">Cidade *</label>
        <input type="text" class="form-control" id="cidade" name="cidade" value="Americana/SP" required readonly>
    </div>
    <div class="form-group">
        <label for="contato">Seu Contato (Telefone/Email) *</label>
        <input type="text" class="form-control" id="contato" name="contato" required>
    </div>
    <div class="form-group">
        <label for="comentario">Características distintivas, informações adicionais</label>
        <textarea class="form-control" id="comentario" name="comentario" rows="3"></textarea>
    </div>
    <div class="form-group">
        <label for="foto_pet">Foto do PET (PNG, JPG, JPEG) *</label>
        <input type="file" class="form-control-file" id="foto_pet" name="foto_pet" accept=".png,.jpg,.jpeg" required>
    </div>
    <button type="submit" class="btn btn-success">Submeter Cadastro</button>
</form>
{% endblock %}

{% block scripts_extra %}
<script>
$(document).ready(function() {
    $('#bairro').change(function() {
        var bairroSelecionado = $(this).val();
        var ruaSelect = $('#rua');
        ruaSelect.empty().append('<option value="">Carregando ruas...</option>');

        if (bairroSelecionado) {
            $.getJSON("{{ url_for('buscar_ruas_por_bairro') }}", { bairro: bairroSelecionado }, function(ruas) {
                ruaSelect.empty().append('<option value="">Selecione a Rua</option>');
                if (ruas.length > 0) {
                    $.each(ruas, function(index, rua) {
                        ruaSelect.append($('<option></option>').attr('value', rua).text(rua));
                    });
                } else {
                     ruaSelect.empty().append('<option value="">Nenhuma rua encontrada para este bairro</option>');
                }
            }).fail(function() {
                 ruaSelect.empty().append('<option value="">Erro ao carregar ruas</option>');
            });
        } else {
            ruaSelect.empty().append('<option value="">Selecione a Rua (após escolher o bairro)</option>');
        }
    });
});
</script>
{% endblock %}
